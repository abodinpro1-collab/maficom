# ğŸ“Š Focus Financier

**Focus Financier** est une application web interactive dÃ©veloppÃ©e avec [Streamlit](https://streamlit.io/) permettant d'analyser en profondeur les comptes des communes franÃ§aises. L'outil offre une visualisation claire et dynamique des principaux indicateurs financiers avec comparaison automatique aux moyennes de strate.

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![Streamlit](https://img.shields.io/badge/Streamlit-1.28+-red.svg)](https://streamlit.io/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

## âœ¨ FonctionnalitÃ©s principales

### ğŸ“ˆ Analyse financiÃ¨re complÃ¨te
- **ğŸ’° Fonctionnement** : Recettes, dÃ©penses, dotations, personnel
- **ğŸ§¾ CapacitÃ© d'Autofinancement (CAF)** : CAF brute et nette
- **ğŸ¦ FiscalitÃ©** : ImpÃ´ts locaux, taux TH/TFB/TFNB
- **ğŸ“‰ Endettement** : Dette par habitant, annÃ©es de CAF
- **ğŸ—ï¸ Investissement** : DÃ©penses d'Ã©quipement
- **ğŸ”„ Fonds de roulement** : En euros et en jours de DRF

### ğŸ¯ FonctionnalitÃ©s avancÃ©es
- âœ… **Comparaison automatique** avec la moyenne de la strate
- ğŸ“Š **Graphiques interactifs** Plotly pour visualiser les Ã©volutions
- ğŸ“„ **Export Excel complet** avec 7 onglets (synthÃ¨se + 6 modules)
- ğŸ“‘ **Rapport PDF professionnel** avec tableaux, graphiques et synthÃ¨se exÃ©cutive
- ğŸ’¾ **Export CSV** pour analyses externes
- ğŸ” **DÃ©tection intelligente des homonymes** de communes
- ğŸ”„ **Gestion des variantes de noms** de communes (avec/sans articles)

## ğŸš€ Installation

### PrÃ©requis
- Python 3.8 ou supÃ©rieur
- pip (gestionnaire de paquets Python)

### Ã‰tapes d'installation

1. **Cloner le dÃ©pÃ´t**
```bash
git clone https://github.com/votre-compte/focus-financier.git
cd focus-financier
```

2. **CrÃ©er un environnement virtuel** (recommandÃ©)
```bash
python -m venv venv

# Activation sous Linux/Mac
source venv/bin/activate

# Activation sous Windows
venv\Scripts\activate
```

3. **Installer les dÃ©pendances**
```bash
pip install -r requirements.txt
```

## â–¶ï¸ Lancement de l'application

```bash
streamlit run prod.py
```

L'application s'ouvre automatiquement dans votre navigateur Ã  l'adresse [http://localhost:8501](http://localhost:8501).

## ğŸ“‚ Structure du projet

```
focus-financier/
â”œâ”€â”€ prod.py                    # Point d'entrÃ©e principal
â”œâ”€â”€ app_fetchers.py           # Module de rÃ©cupÃ©ration des donnÃ©es
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ accueil.py            # Page d'accueil (obsolÃ¨te, voir prod.py)
â”‚   â”œâ”€â”€ fonctionnement.py     # Module Fonctionnement
â”‚   â”œâ”€â”€ caf.py                # Module CAF
â”‚   â”œâ”€â”€ fiscalite.py          # Module FiscalitÃ©
â”‚   â”œâ”€â”€ endettements.py       # Module Endettement
â”‚   â”œâ”€â”€ investissements.py    # Module Investissement
â”‚   â””â”€â”€ fdr.py                # Module Fonds de roulement
â”œâ”€â”€ requirements.txt          # DÃ©pendances Python
â””â”€â”€ README.md                 # Documentation
```

## ğŸ“¦ DÃ©pendances principales

| BibliothÃ¨que | Version | Usage |
|--------------|---------|-------|
| [Streamlit](https://streamlit.io/) | â‰¥1.28 | Framework web interactif |
| [Pandas](https://pandas.pydata.org/) | â‰¥2.0 | Manipulation de donnÃ©es |
| [Plotly](https://plotly.com/python/) | â‰¥5.14 | Graphiques interactifs |
| [Requests](https://docs.python-requests.org/) | â‰¥2.31 | RequÃªtes API |
| [ReportLab](https://www.reportlab.com/) | â‰¥4.0 | GÃ©nÃ©ration PDF |
| [OpenPyXL](https://openpyxl.readthedocs.io/) | â‰¥3.1 | Export Excel |
| [Matplotlib](https://matplotlib.org/) | â‰¥3.7 | Graphiques pour PDF |
| [Seaborn](https://seaborn.pydata.org/) | â‰¥0.12 | Visualisations statistiques |

## ğŸ¯ Utilisation

### 1ï¸âƒ£ SÃ©lection d'une commune
- Saisissez le nom de la commune **EN MAJUSCULES**
- Si plusieurs homonymes existent, sÃ©lectionnez la commune dans la liste dÃ©roulante
- Le dÃ©partement est dÃ©tectÃ© automatiquement

### 2ï¸âƒ£ Choix de la pÃ©riode
- SÃ©lectionnez une ou plusieurs annÃ©es (2019-2023 disponibles)
- Les donnÃ©es sont rÃ©cupÃ©rÃ©es automatiquement depuis l'API

### 3ï¸âƒ£ Navigation
Utilisez la barre latÃ©rale pour accÃ©der aux diffÃ©rents modules :
- **Accueil** : Vue d'ensemble et exports
- **Fonctionnement** : Analyse des recettes et dÃ©penses
- **CAF** : CapacitÃ© d'autofinancement
- **FiscalitÃ©** : ImpÃ´ts et taux
- **Endettement** : Situation de la dette
- **Investissement** : DÃ©penses d'Ã©quipement
- **Fonds de roulement** : TrÃ©sorerie disponible

### 4ï¸âƒ£ Exports
Depuis la page d'accueil, gÃ©nÃ©rez :
- **ğŸ“„ Excel** : Toutes les donnÃ©es sur 7 onglets
- **ğŸ“‘ PDF** : Rapport professionnel avec graphiques
- **ğŸ’¾ CSV** : DonnÃ©es brutes pour analyses externes

## ğŸ”§ Architecture technique

### SystÃ¨me de cache
L'application utilise plusieurs niveaux de cache pour optimiser les performances :
- `@st.cache_data` : Cache des donnÃ©es API
- `@st.cache_resource` : Cache du fetcher de communes
- `@lru_cache` : Cache des normalisations de noms

### Gestion des variantes de communes
Le systÃ¨me `RobustCommuneFetcher` gÃ¨re automatiquement :
- Articles "LA", "LE", "LES" (ex: "La Rochelle" = "Rochelle (LA)")
- Changements de noms historiques
- Recherche par similaritÃ© (seuil 80%)

### Source des donnÃ©es
API : [data.economie.gouv.fr](https://data.economie.gouv.fr/explore/dataset/comptes-individuels-des-communes-fichier-global-a-compter-de-2000/)

## ğŸ› RÃ©solution de problÃ¨mes

### Commune introuvable
- âœ… VÃ©rifiez l'orthographe (MAJUSCULES requises)
- âœ… Essayez avec/sans article (ex: "LA ROCHELLE" vs "ROCHELLE")
- âœ… SpÃ©cifiez le dÃ©partement si plusieurs homonymes

### DonnÃ©es manquantes pour certaines annÃ©es
- Certaines communes n'ont pas publiÃ© de donnÃ©es pour toutes les annÃ©es
- Le message "AnnÃ©es manquantes" indique lesquelles
- Utilisez le bouton "ğŸ” Recherche Ã©largie" pour investiguer

### Erreur d'export PDF
- VÃ©rifiez l'installation de `kaleido` : `pip install kaleido`
- Sous Linux, installez Chrome/Chromium si nÃ©cessaire

## ğŸ¤ Contribution

Les contributions sont les bienvenues ! Pour contribuer :

1. Forkez le projet
2. CrÃ©ez une branche pour votre fonctionnalitÃ© (`git checkout -b feature/AmazingFeature`)
3. Committez vos changements (`git commit -m 'Add AmazingFeature'`)
4. Poussez vers la branche (`git push origin feature/AmazingFeature`)
5. Ouvrez une Pull Request

## ğŸ“ Licence

Ce projet est sous licence MIT - voir le fichier [LICENSE](LICENSE) pour plus de dÃ©tails.

## ğŸ‘¤ Auteur

**Arthur Bodin**

- ğŸ“§ Email : [votre-email@exemple.com]
- ğŸ’¼ LinkedIn : [Votre profil LinkedIn]
- ğŸ™ GitHub : [@votre-username](https://github.com/votre-username)

## ğŸ™ Remerciements

- **Direction GÃ©nÃ©rale des Finances Publiques (DGFiP)** pour les donnÃ©es ouvertes
- **Streamlit** pour le framework
- Tous les contributeurs du projet

## ğŸ“Š Statistiques du projet

![GitHub stars](https://img.shields.io/github/stars/votre-username/focus-financier?style=social)
![GitHub forks](https://img.shields.io/github/forks/votre-username/focus-financier?style=social)
![GitHub issues](https://img.shields.io/github/issues/votre-username/focus-financier)

---

<p align="center">
  Fait avec â¤ï¸ pour faciliter l'analyse financiÃ¨re des communes franÃ§aises
</p>
